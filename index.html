<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardÃ¡pio Digital - Restaurante</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>window.SOCKET_URL = 'http://localhost:3000';</script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
    <script src="assets/js/app.js"></script>
    <script>
        // Usa businessHours e isWithinBusinessHours carregados em assets/js/app.js
        (function() {
            const overlay = document.getElementById('modal-overlay');
            const hEl = document.getElementById('hours');
            const mEl = document.getElementById('minutes');
            const sEl = document.getElementById('seconds');
            const rangeEl = document.getElementById('hoursRange');

            function toHM(str) {
                const [h, m] = String(str || '00:00').split(':').map(n => parseInt(n, 10));
                return { h: isNaN(h) ? 0 : h, m: isNaN(m) ? 0 : m };
            }

            function getTodayHours(hours) {
                if (!hours) return null;
                const map = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
                const key = map[new Date().getDay()];
                return hours[key] || null;
            }

            function computeNextOpening(hours) {
                const now = new Date();
                const dow = now.getDay();
                const map = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
                const today = hours[map[dow]];
                let next = new Date(now);
                next.setSeconds(0); next.setMilliseconds(0);
                if (today && !today.closed) {
                    const o = toHM(today.open);
                    const c = toHM(today.close);
                    const nowMin = now.getHours()*60+now.getMinutes();
                    const openMin = o.h*60+o.m, closeMin = c.h*60+c.m;
                    if (nowMin < openMin) {
                        next.setHours(o.h, o.m, 0, 0);
                        return next;
                    }
                }
                for (let i=1;i<=7;i++) {
                    const idx = (dow + i) % 7;
                    const d = hours[map[idx]];
                    if (d && !d.closed) {
                        const o = toHM(d.open);
                        next = new Date(now);
                        next.setDate(now.getDate()+i);
                        next.setHours(o.h, o.m, 0, 0);
                        return next;
                    }
                }
                return null;
            }

            function formatRange(hours) {
                if (!hours) return '';
                // Se todos os dias iguais, mostra faixa Ãºnica, senÃ£o mostra hoje
                const days = ['monday','tuesday','wednesday','thursday','friday','saturday','sunday'];
                const first = hours[days[0]];
                const allEqual = days.every(k => JSON.stringify(hours[k]) === JSON.stringify(first));
                const pad = v => String(v).padStart(2,'0');
                if (allEqual && first && !first.closed) {
                    const o = toHM(first.open), c = toHM(first.close);
                    return `${pad(o.h)}:${pad(o.m)} Ã s ${pad(c.h)}:${pad(c.m)}`;
                }
                const today = getTodayHours(hours);
                if (today && !today.closed) {
                    const o = toHM(today.open), c = toHM(today.close);
                    return `${pad(o.h)}:${pad(o.m)} Ã s ${pad(c.h)}:${pad(c.m)} (hoje)`;
                }
                return 'Consulte nossos horÃ¡rios';
            }

            function tick() {
                if (typeof isWithinBusinessHours === 'undefined') return;
                // Se elementos nÃ£o existem nesta pÃ¡gina, evita erro e sai
                if (!overlay || !hEl || !mEl || !sEl || !rangeEl) return;
                if (isWithinBusinessHours) {
                    overlay.style.display = 'none';
                    try { document.documentElement.style.overflow = ''; document.body.style.overflow = ''; } catch(_){}
                    return;
                }
                overlay.style.display = 'flex';
                try { document.documentElement.style.overflow = 'hidden'; document.body.style.overflow = 'hidden'; } catch(_){}
                if (businessHours) {
                    rangeEl.textContent = formatRange(businessHours);
                    const next = computeNextOpening(businessHours);
                    if (next) {
                        const now = new Date();
                        const total = Math.max(0, Math.floor((next - now)/1000));
                        const hh = Math.floor(total/3600);
                        const mm = Math.floor((total%3600)/60);
                        const ss = total%60;
                        hEl.textContent = String(hh).padStart(2,'0');
                        mEl.textContent = String(mm).padStart(2,'0');
                        sEl.textContent = String(ss).padStart(2,'0');
                    }
                }
            }
            setInterval(tick, 1000);
            document.addEventListener('DOMContentLoaded', tick);
        })();
    </script>
</body>
</html>



