<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√É¬°pio Digital - Restaurante</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>Card√°pio Digital</h1>
        </div>
    </header>

    <nav id="categoriesList" class="categories"></nav>

    <main class="container">
        <div id="productsGrid" class="products-grid"></div>
    </main>

    <!-- Pizza Builder Modal -->
    <div class="modal-overlay" id="pizzaBuilderModal">
      <div class="modal pizza-builder-modal">
        <div class="modal-content pizza-builder-content">
          <div class="modal-header">
            <h3 id="pizzaBuilderTitle">üçï Monte Sua Pizza</h3>
            <button class="close-modal" onclick="closePizzaBuilder()">
              <i class="fa-solid fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="pizza-progress">
              <div class="progress-step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Tamanho</span>
              </div>
              <div class="progress-step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Sabores</span>
              </div>
              <div class="progress-step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Adicionais</span>
              </div>
              <div class="progress-step" data-step="4">
                <span class="step-number">4</span>
                <span class="step-label">Resumo</span>
              </div>
            </div>

            <!-- Step 1: Tamanho -->
            <div class="pizza-step active" id="step-1">
              <div class="step-header">
                <h4>Escolha o Tamanho da Sua Pizza</h4>
                <p>O tamanho define quantos sabores voc√™ pode escolher</p>
              </div>
              <div class="sizes-grid" id="sizesGrid"></div>
              <div class="step-actions">
                <button class="btn btn-primary" onclick="nextPizzaStep()" disabled id="nextStep1">
                  Continuar <i class="fa-solid fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 2: Sabores -->
            <div class="pizza-step" id="step-2">
              <div class="step-header">
                <h4>Escolha os Sabores</h4>
                <p id="flavorsInfo">Selecione at√© <span id="maxFlavors">1</span> sabor</p>
                <div class="parts-info" style="margin-top:8px;font-size:13px;color:#666;">
                  Partes usadas: <strong><span id="usedPartsCounter">0</span></strong> / <strong><span id="totalPartsCounter">0</span></strong>
                </div>
              </div>
              <div class="flavors-container">
                <div class="pizza-visual">
                  <div class="pizza-circle" id="pizzaCircle"></div>
                  <div class="pizza-info">
                    <h5 id="selectedSizeName">Tamanho</h5>
                    <p id="selectedSizeInfo">Informa√ß√µes do tamanho</p>
                  </div>
                </div>
                <div class="flavors-selection">
                  <div class="flavor-categories">
                    <button class="category-btn active" data-category="all">Todos</button>
                    <button class="category-btn" data-category="tradicional">Tradicionais</button>
                    <button class="category-btn" data-category="especial">Especiais</button>
                    <button class="category-btn" data-category="doce">Doces</button>
                  </div>
                  <div class="flavors-grid" id="flavorsGrid"></div>
                </div>
              </div>
              <div class="step-actions">
                <button class="btn btn-secondary" onclick="previousPizzaStep()"><i class="fa-solid fa-arrow-left"></i> Voltar</button>
                <button class="btn btn-primary" onclick="nextPizzaStep()" disabled id="nextStep2">Continuar <i class="fa-solid fa-arrow-right"></i></button>
              </div>
            </div>

            <!-- Step 3: Adicionais -->
            <div class="pizza-step" id="step-3">
              <div class="step-header">
                <h4>Adicionais (Opcional)</h4>
                <p>Adicione ingredientes extras √† sua pizza</p>
              </div>
              <div class="extras-container">
                <div class="extras-categories">
                  <button class="category-btn active" data-category="all">Todos</button>
                  <button class="category-btn" data-category="queijo">Queijos</button>
                  <button class="category-btn" data-category="carne">Carnes</button>
                  <button class="category-btn" data-category="vegetal">Vegetais</button>
                </div>
                <div class="extras-grid" id="extrasGrid"></div>
              </div>
              <div class="step-actions">
                <button class="btn btn-secondary" onclick="previousPizzaStep()"><i class="fa-solid fa-arrow-left"></i> Voltar</button>
                <button class="btn btn-primary" onclick="nextPizzaStep()" id="nextStep3">Continuar <i class="fa-solid fa-arrow-right"></i></button>
              </div>
            </div>

            <!-- Step 4: Resumo -->
            <div class="pizza-step" id="step-4">
              <div class="step-header">
                <h4>Resumo da Sua Pizza</h4>
                <p>Confirme os detalhes antes de adicionar ao carrinho</p>
              </div>
              <div class="pizza-summary">
                <div class="summary-visual">
                  <div class="pizza-preview" id="pizzaPreview"></div>
                </div>
                <div class="summary-details">
                  <div class="summary-item">
                    <h5>Tamanho</h5>
                    <p id="summarySize">-</p>
                  </div>
                  <div class="summary-item">
                    <h5>Sabores</h5>
                    <p id="summaryFlavors">-</p>
                  </div>
                  <div class="summary-item" id="summaryExtrasContainer" style="display: none;">
                    <h5>Adicionais</h5>
                    <p id="summaryExtras">-</p>
                  </div>
                  <div class="summary-price">
                    <h5>Pre√ßo Total</h5>
                    <p class="price" id="summaryPrice">R$ 0,00</p>
                  </div>
                  <div class="summary-item" style="margin-top:16px;">
                    <h5>Observa√ß√µes (Opcional)</h5>
                    <textarea id="pizzaObservations" rows="3" placeholder="Ex: Sem cebola, bem passada, etc..." style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:inherit;"></textarea>
                  </div>
                  <div class="summary-item" style="margin-top:12px;">
                    <h5>Prefer√™ncias de Preparo</h5>
                    <div class="prefs-grid" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;margin-top:8px;">
                      <label style="display:flex;align-items:center;gap:8px;font-size:14px;"><input type="checkbox" class="pizza-pref" value="Bem passada"> Bem passada</label>
                      <label style="display:flex;align-items:center;gap:8px;font-size:14px;"><input type="checkbox" class="pizza-pref" value="Queijo extra"> Queijo extra</label>
                      <label style="display:flex;align-items:center;gap:8px;font-size:14px;"><input type="checkbox" class="pizza-pref" value="Borda crocante"> Borda crocante</label>
                      <label style="display:flex;align-items:center;gap:8px;font-size:14px;"><input type="checkbox" class="pizza-pref" value="Sem cebola"> Sem cebola</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="step-actions">
                <button class="btn btn-secondary" onclick="previousPizzaStep()"><i class="fa-solid fa-arrow-left"></i> Voltar</button>
                <button class="btn btn-success" onclick="addPizzaToCart()" id="addToCartBtn">
                  <i class="fa-solid fa-cart-shopping"></i> Adicionar ao Carrinho
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de sucesso ap√≥s adicionar pizza -->
    <div class="modal-overlay" id="pizzaAddSuccess">
      <div class="modal success-modal">
        <div class="modal-content">
          <div class="success-icon"><i class="fa-solid fa-circle-check"></i></div>
          <h3>Pizza adicionada ao carrinho!</h3>
          <p>Voc√™ pode continuar navegando ou ir para o carrinho.</p>
          <div style="display:flex;gap:8px;justify-content:center;">
            <button class="btn-secondary" id="btnContinueShopping">Continuar comprando</button>
            <button class="btn-primary" id="btnGoToCart"><i class="fa-solid fa-cart-shopping"></i> Ver carrinho</button>
          </div>
        </div>
      </div>
    </div>

    <script>window.SOCKET_URL = 'http://localhost:3000';</script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
    <script src="assets/js/app.js"></script>
    <script>
        // Usa businessHours e isWithinBusinessHours carregados em assets/js/app.js
        (function() {
            const overlay = document.getElementById('modal-overlay');
            const hEl = document.getElementById('hours');
            const mEl = document.getElementById('minutes');
            const sEl = document.getElementById('seconds');
            const rangeEl = document.getElementById('hoursRange');

            function toHM(str) {
                const [h, m] = String(str || '00:00').split(':').map(n => parseInt(n, 10));
                return { h: isNaN(h) ? 0 : h, m: isNaN(m) ? 0 : m };
            }

            function getTodayHours(hours) {
                if (!hours) return null;
                const map = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
                const key = map[new Date().getDay()];
                return hours[key] || null;
            }

            function computeNextOpening(hours) {
                const now = new Date();
                const dow = now.getDay();
                const map = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
                const today = hours[map[dow]];
                let next = new Date(now);
                next.setSeconds(0); next.setMilliseconds(0);
                if (today && !today.closed) {
                    const o = toHM(today.open);
                    const c = toHM(today.close);
                    const nowMin = now.getHours()*60+now.getMinutes();
                    const openMin = o.h*60+o.m, closeMin = c.h*60+c.m;
                    if (nowMin < openMin) {
                        next.setHours(o.h, o.m, 0, 0);
                        return next;
                    }
                }
                for (let i=1;i<=7;i++) {
                    const idx = (dow + i) % 7;
                    const d = hours[map[idx]];
                    if (d && !d.closed) {
                        const o = toHM(d.open);
                        next = new Date(now);
                        next.setDate(now.getDate()+i);
                        next.setHours(o.h, o.m, 0, 0);
                        return next;
                    }
                }
                return null;
            }

            function formatRange(hours) {
                if (!hours) return '';
                // Se todos os dias iguais, mostra faixa √∫nica, sen√£o mostra hoje
                const days = ['monday','tuesday','wednesday','thursday','friday','saturday','sunday'];
                const first = hours[days[0]];
                const allEqual = days.every(k => JSON.stringify(hours[k]) === JSON.stringify(first));
                const pad = v => String(v).padStart(2,'0');
                if (allEqual && first && !first.closed) {
                    const o = toHM(first.open), c = toHM(first.close);
                    return `${pad(o.h)}:${pad(o.m)} √†s ${pad(c.h)}:${pad(c.m)}`;
                }
                const today = getTodayHours(hours);
                if (today && !today.closed) {
                    const o = toHM(today.open), c = toHM(today.close);
                    return `${pad(o.h)}:${pad(o.m)} √†s ${pad(c.h)}:${pad(c.m)} (hoje)`;
                }
                return 'Consulte nossos hor√°rios';
            }

            function tick() {
                if (typeof isWithinBusinessHours === 'undefined') return;
                // Se elementos n√£o existem nesta p√°gina, evita erro e sai
                const overlay = document.getElementById('modal-overlay');
                const hEl = document.getElementById('hours');
                const mEl = document.getElementById('minutes');
                const sEl = document.getElementById('seconds');
                const rangeEl = document.getElementById('hoursRange');
                if (!overlay || !hEl || !mEl || !sEl || !rangeEl) return;
                if (isWithinBusinessHours) {
                    overlay.style.display = 'none';
                    try { document.documentElement.style.overflow = ''; document.body.style.overflow = ''; } catch(_){ }
                    return;
                }
                overlay.style.display = 'flex';
                try { document.documentElement.style.overflow = 'hidden'; document.body.style.overflow = 'hidden'; } catch(_){ }
                if (businessHours) {
                    rangeEl.textContent = formatRange(businessHours);
                    const next = computeNextOpening(businessHours);
                    if (next) {
                        const now = new Date();
                        const total = Math.max(0, Math.floor((next - now)/1000));
                        const hh = Math.floor(total/3600);
                        const mm = Math.floor((total%3600)/60);
                        const ss = total%60;
                        hEl.textContent = String(hh).padStart(2,'0');
                        mEl.textContent = String(mm).padStart(2,'0');
                        sEl.textContent = String(ss).padStart(2,'0');
                    }
                }
            }
            setInterval(tick, 1000);
            document.addEventListener('DOMContentLoaded', tick);
        })();
    </script>
</body>
</html>



